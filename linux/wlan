#!/bin/sh -x
# try to connect to the wrong wlan in order to force netctl-auto to reconnect
# test if we can ping localhost
if timeout 1s ping -c 1 -W 1 -q localhost >/dev/null; then
  # test if we can ping google
  if timeout 1s ping -c 1 -W 1 -q google.com >/dev/null; then
    echo Info: You seem to have internet connection. >&2
  else
    cmd="netctl-auto list|grep -v '^\* '|head -n 1|xargs netctl-auto switch-to"
    if [ `id -u` -ne 0 ]; then
      export SUDO_ASKPASS=/usr/lib/ssh/ssh-askpass
      sudo sh -c "$cmd"
    else
      $cmd
    fi
  fi
else
  echo Error: Can not ping localhost. >&2
  exit 1
fi
