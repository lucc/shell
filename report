#!/usr/bin/make -f

ifeq ($(shell test -t 1 && echo term),term)
  header = echo '\033[32m$1\033[m'
else
  header = echo '$1'
endif

all: software notmuch git
software:
	@cecho green Updates:
	@echo There are `pacman -Quq | wc -l` updates available.
git:
	@cecho green Dirty git repositories:
	@find $(HOME)                                         \
	  -regex '^$(HOME)/\(\.local\|.cache\|build\|vcs\)' -prune -o \
	  \(                                                  \
	    -type d                                           \
	    -name .git                                        \
	    -execdir git is-dirty \;                          \
	    -exec dirname {} \;                               \
	  \) 2>/dev/null
mail:
	@cecho green New mail:
	@~/src/mailtools/check.py -e lists/zsh -e draft ~/mail || \
	  echo No new mail.
notmuch:
	@cecho green New mail:
	@if [ `notmuch count tag:inbox AND tag:unread` -eq 0 ]; then echo No new mail.; else notmuch search tag:inbox AND tag:unread; fi
test:
	@echo $$TERM

.PHONY: software git mail all test notmuch
# vim: ft=make
